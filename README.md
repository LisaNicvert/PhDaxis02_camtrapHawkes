# Analyze camera trap data with the Hawkes process

This repository contains the code and data (Pardo et al., 2021) to reproduce the analyses and figures from the article *Using the multivariate Hawkes model to study reactive temporal interactions between multiple species from camera trap data* (Nicvert et al., 2023).

## Contents

-   `analyses/` contains all code to run the analyses
-   `data/` contains the camera trap data and species silhouettes used for plotting
-   `figures/` contains the high-quality figures used in the article generated by the analyses
-   `man/` contains the documentation fir the functions written in `R/`
-   `outputs/` contains the outputs generated during the analyses
-   `R/` contains the R functions developed for this project
-   `DESCRIPTION` contains the project metadata (author, date, dependencies, etc.)
-   `NAMESPACE` contains the namespace information for the functions in the `R/` folder.
-   `LICENCE.md` contains the full licence for the R code.
-   `install_dependencies.R`: R script to install all R libraries.
-   `UnitEvents_0.0.8.tar.gz`: source package for `UnitEvents`.
-   `Dockerfile`: the file to create a Docker environment

## Packages installation

In order to install the environment needed to run the analyses, you have two choices:

-   install the packages with R
-   use [Docker](https://www.docker.com/)

### Install packages via R

#### Install `UnitEvents` dependencies

In order to run the analyses, some dependencies must be installed outside R for the package `UnitEvents` (Albert et al., 2021).

-   **Installing dependencies on Linux:** run the following command in the terminal:

```{bash}
sudo apt install cmake g++ git subversion
```

-   **Installing dependencies on Mac OS**: you will need to configure a command line installer like [MacPorts](https://www.macports.org/) of [Homebrew](https://brew.sh/). A C++ compiler should also have been installed before (through Xcode for example). Assuming MacPorts is installed, run:

```{bash}
sudo port install cmake subversion git
```

-   **Windows**: installing `UnitEvents 0.0.8` on Windows is not yet possible.

The up-to-date repository and instructions to install to install `UnitEvents` can also be found on [the development team repository](https://sourcesup.renater.fr/frs/?group_id=3267).

#### Install other packages

To install the needed R packages (including `UnitEvents`, once the dependencies above have been installed), you can run the script `install_dependencies.R`. The required packages are sorted by analysis, so you can choose which packages to install depending on your needs.

### Use Docker

#### Build the Docker

The `Dockerfile` provided at the root of the repository allows to build a Docker installing the required dependencies.

*NB: You need admin privileges to run Docker; either add your user to the Docker group (`sudo groupadd docker`), use `sudo` or run as `root`.*

In order to build the Docker, navigate to the directory containing the Dockerfile and use:

```{bash}
docker build . -t camtrap_hawkes_docker
```

Then, install required R packages. For that, connect to the interactive Docker interface:

```{bash}
docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
```

Then, inside Docker, set the default library path for R packages. Here, we will use (`/home/ubuntu/R_camtrapHawkes` but you can use a different path (only make sure the directory already exists):

```{bash}
> mkdir /home/ubuntu/R_camtrapHawkes
> export R_LIBS="/home/ubuntu/R_camtrapHawkes"
```

Finally, run the `install_dependencies.R` script inside the Docker in order to install the required R packages :

```{bash}
> cd /opt/camtrapHawkes
> Rscript install_dependencies.R
```

#### Run analyses

Note: you will need to specify the library to use each time you run the Docker using `export R_LIBS="/home/ubuntu/R_camtrapHawkes"`.

To run the analyses, you can use the interactive mode of Docker.

-   To run all scripts (except the simulation of inter-event times in `analyses/02_simulation_interevent_times/` that cannot be run locally):

```{bash}
docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
> export R_LIBS="/home/ubuntu/R_camtrapHawkes"
> Rscript camtrapHawkes/analyses/run_all.R
```

-   To render Quarto documents:

```{bash}
docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
> export R_LIBS="/home/ubuntu/R_camtrapHawkes"
> R
> quarto::quarto_render([path_to_qmd])
```

-   To run R scripts:

```{bash}
docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
> export R_LIBS="/home/ubuntu/R_camtrapHawkes"
> Rscript [path_to_script]
```

### Details

In each analysis script, the functions contained in `R/` are loaded with `library(camtrapHawkes)`.

Other needed packages are loaded (and if needed, installed) for each analysis script with a custom `camtrapHawkes::require` function.

## Licences

The code used to perform analyses and produce figures of this project is licensed under the [Creative Commons Attribution 4.0 International License](http://creativecommons.org/licenses/by/4.0/).

The underlying source code used generate content (contained in the `R/` folder and associated to the package) is licensed under the [GPL \>= 2 licence](https://www.gnu.org/licenses/old-licenses/gpl-2.0.html).

The raw data in `data/camtrap_data/data.csv` is licenced under...

## References

Albert, M., Bouret, Y., Chevallier, J., Fromont, M., Grammont, F., Laloe, T., Mascart, C., Reynaud-Bouret, P., Rouis, A., Scarella, G., & Tuleau-Malot, C. (2021). *UnitEvents: Unitary Events Method
with Delayed Coincidence Count (MTGAUE or Permutation Method) and Bernstein Lasso method for Hawkes processes* (0.0.8).
<https://sourcesup.renater.fr/frs/?group_id=3267>

Nicvert L., Donnet S., Keith M., Peel M., Somers M. J., Swanpoel L. H., Venter J., Fritz H. & Dray S (2023). *Using the multivariate Hawkes model to study reactive temporal interactions between multiple species from camera trap data.* [Manuscript in preparation]

Pardo, Lain E. and Bombaci, Sara P. and Huebner, Sarah and Somers, Michael J. and Fritz, Herve and Downs, Colleen and Guthmann, Abby and Hetem, Robyn S. and Keith, Mark and le Roux, Aliza and Mgqatsa, Nokubonga and Packer, Craig and Palmer, Meredith S. and Parker, Daniel M. and Peel, Mike and Slotow, Rob and Strauss, W. Maartin and Swanepoel, Lourens and Tambling, Craig and Tsie, Nairobi and Vermeulen, Mika and Willi, Marco and Jachowski, David S. and Venter, Jan A. (2021). *Snapshot Safari: A large-scale collaborative to monitor Africa's remarkable biodiversity.* South African Journal of Science, 117(1/2). <https://doi.org/10.17159/sajs.2021/8134>
