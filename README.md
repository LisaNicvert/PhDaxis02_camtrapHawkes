# Analyze camera trap data with the Hawkes process

This repository contains the code to reproduce the analyses and figures from the article *Using the Hawkes model to study spatio-temporal interactions between multiple species from camera trap data*.

## Packages installation

In order to install the environment needed to run the analyses, you have two choices:

-   install the packages with R
-   use [Docker](https://www.docker.com/)

### Install packages via R

#### Install `UnitEvents` dependencies

In order to run the analyses, some dependencies must be installed outside R for the package `UnitEvents` (Lambert et al., 2018).

-   **Installing dependencies on Linux:** run the following command in the terminal:

```{bash}
sudo apt install cmake g++ git subversion
```

-   **Installing dependencies on Mac OS**: you will need to configure a command line installer like [MacPorts](https://www.macports.org/) of [Homebrew](https://brew.sh/). A C++ compiler should also have been installed before (through Xcode for example). Assuming MacPorts is installed, run:

```{bash}
sudo port install cmake subversion git
```

-   **Windows**: installing `UnitEvents 0.0.8` on Windows is not yet possible.

The up-to-date repository and instructions to install to install `UnitEvents` can also be found on [the development team repository](https://sourcesup.renater.fr/frs/?group_id=3267).

#### Install other packages

To install the needed R packages (including `UnitEvents`, once the dependencies above have been installed), you can run the script `install_dependencies.R`. The required packages are sorted by analysis, so you can choose which packages to install depending on your needs.

### Use Docker

#### Build the Docker

The `Dockerfile` provided at the root of the repository allows to build a Docker installing the required dependencies.

In order to build the Docker, navigate to the directory containing the Dockerfile use:

```{bash}
sudo docker build . -t camtrap_hawkes_docker
```

Then, install required R packages. For that, connect to the interactive Docker interface:

```{bash}
sudo docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
```

Then, inside Docker, set the default library path for R packages. Here, we choose the local R library (`/home/ubuntu/Rx86_64-pc-linux-gnu-library/4.2`) but you can use a different path (only make sure the directory already exists):

```{bash}
> export R_LIBS="/home/ubuntu/R/x86_64-pc-linux-gnu-library/4.2"
```

Finally, run the `install_dependencies.R` script inside the Docker in order to install the required R packages :

```{bash}
> cd /opt/camtrapHawkes
> Rscript install_dependencies.R
```

#### Run analyses

Note: you will need to specify the library to use each time you run the Docker using `export R_LIBS="/home/ubuntu/R/x86_64-pc-linux-gnu-library/4.2"`.

To run the analyses, you can use the interactive mode of Docker.

-   To render Quarto documents:

```{bash}
sudo docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
> export R_LIBS="/home/ubuntu/R/x86_64-pc-linux-gnu-library/4.2"
> R
> quarto::quarto_render([path_to_qmd])
```

-   To run R scripts:

```{bash}
sudo docker run -it -v $HOME/:/home/ubuntu camtrap_hawkes_docker bash
> export R_LIBS="/home/ubuntu/R/x86_64-pc-linux-gnu-library/4.2"
> Rscript [path_to_script]
```

You can also run Rstudio inside the Docker:

```{bash}
docker run -v $HOME:/home/ubuntu -p 8787:8787 -e PASSWORD=pwd camtrap_hawkes_docker
```

Then connect to port 8787 of the machine with the user `rstudio` and the password `pwd`.

For instance, on your web browser, you would use the following URL: [`http://localhost:8787`](http://localhost:8787). When prompted to enter credentials, use the user `rstudio` and the password `pwd`.

### Details

In each analysis script, the functions contained in `R/` are loaded with `devtools::load_all()`.

Other needed packages are loaded (and if needed, installed) for each analysis script with a custom `camtrapHawkes::require` function.

## Contents

-   `analyses/` contains all code to run the analyses
-   `data/` contains the camera trap data and species silhouettes used for plotting
-   `figures/` contains the high-quality figures used in the article generated by the analyses
-   `man/` contains the documentation fir the functions written in `R/`
-   `outputs/` contains the outputs generated during the analyses
-   `R/` contains the R functions developed for this project
-   `DESCRIPTION` contains the project metadata (author, date, dependencies, etc.)
-   `NAMESPACE` contains the namespace information for the functions in the `R/` folder.
-   `install_dependencies.R`: R script to install all R libraries.
-   `UnitEvents_0.0.8.tar.gz`: source package for `UnitEvents`.
-   `Dockerfile`: the file to create a Docker environment

## References

Lambert, R. C., Tuleau-Malot, C., Bessaih, T., Rivoirard, V., Bouret, Y., Leresche, N., & Reynaud-Bouret, P. (2018). Reconstructing the functional connectivity of multiple spike trains using Hawkes models. Journal of Neuroscience Methods, 297, 9--21. <https://doi.org/10.1016/j.jneumeth.2017.12.026>

Nicvert L., Donnet S., Keith M., Peel M., Somers M. J., Swanpoel L. H., Venter J., Fritz H. & Dray S (2023). Using the Hawkes model to study spatio-temporal interactions between multiple species from camera trap data. [Manuscript in preparation]
